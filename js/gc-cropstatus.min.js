"use strict";Vue.component("gc-cropstatus",{props:{chartid:{type:String,default:"cropstatus1",required:!0},gcApikey:{type:String,default:"39553fb7-7f6f-4945-9b84-a4c8745bdbec"},gcHost:{type:String,default:"geocledian.com"},gcParcelId:{default:-1},sdate:{type:String,default:""},mode:{type:String,default:"gauge"},showOptions:{type:String,default:"false"},showDateSelector:{type:String,default:"true"},showTitleBlock:{type:String,default:"true"}},template:'<div :id="chartid" class="gc-cropstatus" style="max-width: 18.0rem;">          \n            \n            <p class="chartOptionsTitle is-size-6 is-orange is-inline-block" style="margin-bottom: 1.0rem; cursor: pointer;" \n                v-on:click="toggleChartOptions" v-if="this.showOptions == \'true\'">\n               Chart options \n              <i class="fas fa-angle-down fa-sm"></i>\n            </p>\n\n            <div :id="\'chartOptions_\'+chartid" class="chartOptions is-horizontal is-flex is-hidden"\n                  style="max-height: 6.6rem !important;">\n            </div>\x3c!-- chart options --\x3e\n\n            <div>\n              <div :id="\'titleBlock_\' + chartid" class="is-grey is-inline-block" v-if="showTitleBlock == \'true\'">\n                <span :id="\'title_\' + chartid" class="has-text-weight-bold is-size-6">Crop status</span><br>\n                <span :id="\'subtitle_\' + chartid"class="has-text-weight-bold is-size-7">Parcel ID: {{this.currentParcelID}}</span><br>\n                <span :id="\'sdate_\' + chartid"class="is-size-7" v-if="this.crop_status.hasOwnProperty(\'crop_status\')">Sensing date: {{this.crop_status.crop_status.sensing_date}}</span>\n              </div>\n\n              <div :id="\'sDate_\'+this.chartid" class="field-body is-horizontal is-inline-block is-pulled-right" style="vertical-align: top;" v-if="showDateSelector==\'true\'">\n                <div class="control has-icons-left" style="padding-bottom: 10px; max-width: 6.4rem;">\n                  <input :id="\'inpSdate_\'+this.chartid" type="text" class="input is-small"\n                  placeholder="[YYYY-MM-DD]" v-model="sdate">\n                  <span class="icon is-small is-left">\n                    <i class="fas fa-clock fa-lg"></i>\n                  </span>\n                </div>\n              </div>\n              \x3c!-- watermark --\x3e\n              <div class="is-pulled-right is-inline-block" style="opacity: 0.65;">\n                <span style="verticalalign: top; font-size: 0.7rem;">powered by</span><br>\n                <img src="img/logo.png" alt="geo|cledian" style="width: 100px; margin: -10px 0;">\n              </div>\n            </div>\n\n            <div :id="\'chartNotice_\'+chartid" class="content is-hidden"></div>\n            \n            <div :id="\'chartSpinner_\'+chartid" class="chartSpinner spinner is-hidden">\n              <div class="rect1"></div>\n              <div class="rect2"></div>\n              <div class="rect3"></div>\n              <div class="rect4"></div>\n              <div class="rect5"></div>\n            </div>\n\n\n          <div style="position: relative;">\n            <div :id="\'chart_\'+chartid" class="">\n            </div>\n          </div>\n\n          </div>\n          \x3c!-- chart --\x3e',data:function(){return{chart:void 0,parcels:[],apiKey:this.gcApikey,apiHost:this.gcHost,apiUrl:"https://"+this.gcHost+"/agknow/api/v3",offset:0,pagingStep:6e3,total_parcel_count:250,chartLegendVisible:!0,crop_status:{},inpSdatePicker:void 0}},computed:{currentParcelID:{get:function(){return this.gcParcelId},set:function(newValue){this.gcParcelId=newValue}},chartWidth:function(){return console.debug("clientwidth "+document.getElementById(this.chartid).clientWidth),console.debug("offsetwidth "+document.getElementById(this.chartid).offsetWidth),parseInt(document.getElementById(this.chartid).offsetWidth)},chartHeight:function(){return console.debug("clientheight "+document.getElementById(this.chartid).clientHeight),console.debug("offsetheight "+document.getElementById(this.chartid).offsetHeight),parseInt(document.getElementById(this.chartid).style.height)}},created:function(){},mounted:function(){window.addEventListener("resize",this.triggerResize),document.getElementById("chart_"+this.chartid).classList.add("is-hidden"),document.getElementById("chartSpinner_"+this.chartid).classList.remove("is-hidden"),this.chart=c3.generate({bindto:"#chart_"+this.chartid,size:{width:this.chartWidth,height:this.chartHeight},data:{columns:[],type:this.mode}}),this.gcParcelId>0&&(this.currentParcelID=this.gcParcelId,this.handleCurrentParcelIDchange()),"true"===this.showDateSelector&&this.loadJSscript("css/bulma-ext/bulma-calendar.min.js",function(){this.inpSdatePicker=new bulmaCalendar(document.getElementById("inpSdate_"+this.chartid),{startDate:new Date(Date.parse(this.sdate)),dateFormat:"yyyy-mm-dd",lang:"en",overlay:!1,closeOnOverlayClick:!0,closeOnSelect:!0,onSelect:function(e){var a=new Date(e.valueOf()+864e5);this.sdate=a.toISOString().split("T")[0]}.bind(this)})}.bind(this))},watch:{currentParcelID:function(newValue,oldValue){console.debug("event - currentParcelIDChange"),this.handleCurrentParcelIDchange(newValue,oldValue)},sdate:function(newValue,oldValue){console.debug("event - sdateChange"),this.isDateValid(this.sdate)&&this.getCropStatus(this.getCurrentParcel().parcel_id,this.sdate)},crop_status:{handler:function(newValue,oldValue){console.debug("event - crop_statusChange"),this.createChartData()},deep:!0}},methods:{triggerResize:function(){console.debug("triggerResize()"),this.chart.resize({width:document.getElementById(this.chartid).offsetWidth-20})},handleCurrentParcelIDchange:function(){console.debug("methods - handleCurrentParcelIDchange"),this.currentParcelID>0&&(this.filterDetailData(),this.getCropStatus(this.getCurrentParcel().parcel_id,this.sdate))},filterDetailData:function(){console.debug("methods - filterDetailData")},getCurrentParcel:function(){return{parcel_id:this.currentParcelID}},getCropStatus:function(parcel_id,sdate){try{document.getElementById("sDate_"+this.chartid).classList.remove("is-hidden")}catch(ex){}try{document.getElementById("titleBlock_"+this.chartid).classList.remove("is-hidden")}catch(ex){}document.getElementById("chartNotice_"+this.chartid).classList.add("is-hidden"),document.getElementById("chart_"+this.chartid).classList.add("is-hidden"),document.getElementById("chartSpinner_"+this.chartid).classList.remove("is-hidden");const productName="status";var params="/parcels/"+parcel_id+"/status?key="+this.apiKey+"&sdate="+sdate,xmlHttp=new XMLHttpRequest,async=!0;console.debug("getCropStatus()"),console.debug("GET "+this.apiUrl+params),this.chart.unload(),xmlHttp.onreadystatechange=function(){if(4==xmlHttp.readyState)try{var tmp=JSON.parse(xmlHttp.responseText);if("key is not authorized"==tmp.content){try{document.getElementById("sDate_"+this.chartid).classList.add("is-hidden")}catch(ex){}try{document.getElementById("titleBlock_"+this.chartid).classList.add("is-hidden")}catch(ex){}return document.getElementById("chartNotice_"+this.chartid).innerHTML="Sorry, the given API key is not authorized!<br> Please contact <a href='https://www.geocledian.com'>geo|cledian</a> for a valid API key.",document.getElementById("chartNotice_"+this.chartid).classList.remove("is-hidden"),void document.getElementById("chartSpinner_"+this.chartid).classList.add("is-hidden")}if("api key validity expired"==tmp.content){try{document.getElementById("sDate_"+this.chartid).classList.add("is-hidden")}catch(ex){}try{document.getElementById("titleBlock_"+this.chartid).classList.add("is-hidden")}catch(ex){}return document.getElementById("chartNotice_"+this.chartid).innerHTML="Sorry, the given API key's validity expired!<br> Please contact <a href='https://www.geocledian.com'>geo|cledian</a>for a valid API key.",document.getElementById("chartNotice_"+this.chartid).classList.remove("is-hidden"),void document.getElementById("chartSpinner_"+this.chartid).classList.add("is-hidden")}var row=this.getCurrentParcel();tmp.hasOwnProperty("crop_status")&&(this.crop_status=tmp)}catch(err){console.error(err);try{document.getElementById("sDate_"+this.chartid).classList.add("is-hidden")}catch(ex){}try{document.getElementById("titleBlock_"+this.chartid).classList.add("is-hidden")}catch(ex){}document.getElementById("chartNotice_"+this.chartid).innerHTML="Sorry, an error occurred!<br>Please check the console log for more information.",document.getElementById("chartNotice_"+this.chartid).classList.remove("is-hidden"),document.getElementById("chartSpinner_"+this.chartid).classList.add("is-hidden")}}.bind(this),xmlHttp.open("GET",this.apiUrl+params,!0),xmlHttp.send()},createChartData:function(){console.debug("createChartData()");let columns=[];if(this.crop_status.hasOwnProperty("crop_status")){if("pie"==this.mode||"donut"==this.mode){columns[0]=["area under crops"].concat(this.formatDecimal(this.crop_status.crop_status.area_under_crops,2));const uncultivated_area=this.crop_status.summary.area*(1-this.crop_status.crop_status.fraction_under_crops);columns[1]=["uncultivated area"].concat(this.formatDecimal(uncultivated_area,2))}"gauge"==this.mode&&(columns[0]=["fraction under crops"].concat(this.formatDecimal(100*this.crop_status.crop_status.fraction_under_crops,2))),document.getElementById("chartSpinner_"+this.chartid).classList.add("is-hidden"),document.getElementById("chart_"+this.chartid).classList.remove("is-hidden"),document.getElementById("chartNotice_"+this.chartid).classList.add("is-hidden"),this.createChart(columns)}},createChart:function(data){let color_options={};"gauge"==this.mode&&(color_options={pattern:["#FF0000","#F97600","#F6C600","#60B044"],threshold:{max:100,values:[25,50,75,100]}});let pie_options={},pie_color_options={};"pie"!=this.mode&&"donut"!=this.mode||(pie_options={label:{format:function(value,ratio,id){return this.formatDecimal(value,1)+" ha"}.bind(this)}},pie_color_options={"area under crops":"#60B044","uncultivated area":"#FF0000"}),this.chart=c3.generate({bindto:"#chart_"+this.chartid,size:{width:this.chartWidth,height:this.chartHeight},data:{columns:[],type:this.mode,colors:pie_color_options},pie:pie_options,color:color_options,transition:{duration:750}}),this.chart.load({columns:data})},toggleChartOptions:function(){let isGraphOptionsActive=!1;isGraphOptionsActive=!document.getElementById("chartOptions_"+this.chartid).classList.contains("is-hidden"),isGraphOptionsActive?(document.getElementById("chartOptions_"+this.chartid).classList.add("is-hidden"),document.getElementById(this.chartid).getElementsByClassName("chartOptionsTitle")[0].children[0].classList.remove("is-active")):(document.getElementById("chartOptions_"+this.chartid).classList.remove("is-hidden"),document.getElementById(this.chartid).getElementsByClassName("chartOptionsTitle")[0].children[0].classList.add("is-active"))},removeFromArray:function(arry,value){let index=arry.indexOf(value);return index>-1&&arry.splice(index,1),arry},formatDecimal:function(decimal,numberOfDecimals){var factor=100;return isNaN(parseFloat(decimal))?NaN:(1==numberOfDecimals&&(factor=10),2==numberOfDecimals&&(factor=100),3==numberOfDecimals&&(factor=1e3),4==numberOfDecimals&&(factor=1e4),5==numberOfDecimals&&(factor=1e5),Math.ceil(decimal*factor)/factor)},capitalize:function(s){return"string"!=typeof s?"":s.charAt(0).toUpperCase()+s.slice(1)},isDateValid:function(date_str){return!isNaN(new Date(date_str))},loadJSscript:function(url,callback){let script=document.createElement("script");script.src=url,document.body.appendChild(script),script.onload=function(){callback()}}},beforeDestroy:function(){window.removeEventListener("resize",this.triggerResize)}});